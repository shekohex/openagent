{
  "id": "task-27",
  "title": "Agent Control API (sidecar)",
  "description": "Implement sidecar endpoints for message, command, shell, permissions using SDK.",
  "requirements": [
    "Define JSON schemas for inputs/outputs",
    "Map routes to SDK: prompt, command, shell, permissions",
    "Support streaming responses when available",
    "Authn via registration/WS token"
  ],
  "plan": [
    "POST /control/prompt routes to session.prompt",
    "POST /control/command routes to session.command",
    "POST /control/shell routes to session.shell",
    "POST /control/permissions/:id responds to permission"
  ],
  "expected_outcome": "Sidecar exposes control endpoints mapped to opencode.",
  "acceptance_criteria": [
    "All endpoints return 2xx on happy path",
    "Invalid inputs yield 400 with details",
    "Streaming endpoints flush incremental data"
  ],
  "deliverables": [
    "apps/sidecar/routes/control/prompt.ts",
    "apps/sidecar/routes/control/command.ts",
    "apps/sidecar/routes/control/shell.ts",
    "apps/sidecar/routes/control/permissions.ts"
  ],
  "test_plan": [
    "Unit tests for schema validation",
    "Integration: prompt -> streamed response"
  ],
  "references": [
    "PLAN.md",
    "opencode SDK"
  ],
  "dependencies": ["task-21", "task-23"],
  "status": "pending"
}
